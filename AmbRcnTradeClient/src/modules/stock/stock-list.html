<template>
  <require from="./lotNo-filter-value-converter"></require>

  <toolbar type="menu" caption="Stocks" list-route="stockBalanceList">
    <toolbar-item icon="fa fa-plus" click.call="addStock()"></toolbar-item>
  </toolbar>

  <div class="card">
    <div class="card-header">
      <h4>Stock list</h4>
      <div class="my-4">
        Please go to the <a route-href="stockBalanceList" class="with-decoration">Stock Balances</a> page to select
        which stocks to stuff into a container
      </div>
    </div>

    <div class="card-body">
      <div class="mb-4 d-flex justify-content-between align-items-end">
        <div class="mr-2 w-100">
          <select-input source.bind="locations | customerFilter:'warehouse' " value.bind="selectedLocation"
            label="Select warehouse location" warn-null="false">
          </select-input>
        </div>

        <div class="mr-2 w-100">
          <div class="form-label">Filter by lot numbers</div>
          <select class="custom-select" value.bind="filterLotNo">
            <option>[All]</option>
            <option repeat.for="item of lotNoList">${item}</option>
          </select>
        </div>
        <div>
          <button type="button" class="btn btn-sm btn-primary" click.delegate="runQuery()">
            <i class="fas fa-search"></i>
          </button>
        </div>
      </div>


      <table class="table table-sm small">
        <thead>
          <tr>
            <th>Lot no</th>
            <th>Date</th>
            <th>Location</th>
            <th>Supplier</th>
            <th>Origin</th>
            <th>Stock in</th>
            <th>Stock out</th>
            <th>Avg. quality</th>
            <th>Container details</th>
          </tr>
        </thead>
        <tbody>
          <tr repeat.for="item of list | lotNoFilter: filterLotNo" class="${!item.isStockIn ? 'bg-light' : ''}">
            <td>
              <a route-href="stockEdit; params.bind:{id: encode(item.stockId)}" class="with-decoration">Stock: Lot
                ${item.lotNo}</a><br>
              <a route-href="inspectionEdit; params.bind:{id: encode(item.inspectionId)}"
                class="with-decoration">Inspection:
                ${item.inspectionDate | dateFormat: "DD/MM/YYYY"}</a>
            </td>
            <td>${item.stockDate | dateFormat: "DD/MM/YYYY"}</td>
            <td>${item.locationName}</td>
            <td>${item.supplierName}</td>
            <td>${item.origin}</td>
            <td>
              <div if.bind="item.bagsIn>0">${item.bagsIn | numberFormat: "0,0"} bags<br>
                <span class="font-italic small">${item.weightKgIn | numberFormat:"0,0"} kg</span>
              </div>
            </td>
            <td class="text-success">
              <div if.bind="item.bagsOut > 0">
                ${item.bagsOut | numberFormat: "0,0"} bags<br>${item.weightKgOut | numberFormat:"0,0"} kg
              </div>
            </td>
            <td>
              KOR ${item.analysisResult.kor | numberFormat: "0,0.00"}<br>
              Count ${item.analysisResult.count | numberFormat: "0,0"}<br>
              Moisture ${item.analysisResult.moisture/100 | numberFormat: "0.00%"}
            </td>
            <td>
              <ul class="list-unstyled">
                <li repeat.for="sr of item.stuffingRecords">
                  <a class="with-decoration" route-href="containerEdit; params.bind:{id: encode(sr.containerId)}">
                    ${sr.containerNumber}
                    <!-- Stuffed: ${sr.stuffingDate | dateFormat: "DD/MM/YYYY"} -->
                  </a>
                </li>
              </ul>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <th>Stock balance</th>
            <th>${stockBalance.bags | numberFormat: "0,0"} bags</th>
            <th class="font-italic">Approx. ${stockBalance.weightKg/1000 | numberFormat: "0,0"} tons</th>
            <th colspan="7"></th>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</template>
