<template>
  <toolbar type="menu" caption="Payment" save.call="save()" disabled-save.bind="!canSave" list-route="paymentList">
  </toolbar>

  <debug-console model.bind="model.payment"></debug-console>

  <div class="card">
    <div class="card-header">
      <h4>${caption}</h4>
    </div>

    <div class="card-body">
      <div class="row">
        <div class="col-4">
          <date-input value.bind="model.payment.paymentDate" label="Payment date"></date-input>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <select-input source.bind="customerList | customerFilter: 'supplier'" use-model-id="true"
            value.bind="model.payment.supplierId" label="Payee (Supplier)"></select-input>
        </div>
        <div class="col">
          <select-input source.bind="customerList | customerFilter: 'supplier'" use-model-id="true" warn-null="false"
            value.bind="model.payment.beneficiaryId" label="Final beneficiary"></select-input>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <div class="d-flex">
            <select-input source.bind="currencyList" use-model-id="true" value.bind="model.payment.currency"
              label="Currency"></select-input>
            <number-input value.bind="model.payment.value" label="Value"></number-input>
          </div>
        </div>
        <div class="col">
          <number-input value.bind="model.payment.exchangeRate" label="Ex rate"></number-input>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <text-area-input value.bind="model.payment.notes" label="Notes"></text-area-input>
        </div>
      </div>

      <div class="card-footer card-footer-info">
        <div if.bind="needExchangeRate">Since the payment is in ${model.payment.currency} please provide an exchange
          rate</div>
      </div>
    </div>
  </div>

  <div class="card mt-3">
    <div class="card-body">
      <section id="payments-purchases">
        <div class="row mt-2">
          <div class="col">
            <h5>Payments</h5>
            <table class="table table-sm table-bordered small">
              <thead>
                <tr>
                  <th>Payment no.</th>
                  <th>Date</th>
                  <th>Payee (Supplier)</th>
                  <th>Beneficiary</th>
                  <th>Value</th>
                </tr>
              </thead>
              <tbody>
                <tr repeat.for="item of model.paymentList">
                  <td>${item.paymentNo}</td>
                  <td>${item.date | dateFormat: "DD/MM/YYYY"}</td>
                  <td>${item.supplierName}</td>
                  <td>${item.beneficiaryName}</td>
                  <td>${item.currency.toUpperCase()} ${item.value | numberFormat:"0,0"} @ ExRate ${item.exchangeRate |
                    numberFormat: "0,0.0000"}</td>
                </tr>
              </tbody>
            </table>
          </div>


          <div class="col">
            <h5>Purchases</h5>
            <table class="table table-sm table-bordered small">
              <thead>
                <tr>
                  <th>Purchase no.</th>
                  <th>Purchase date</th>
                  <th>Supplier</th>
                  <th>Bags IN</th>
                  <th>Value</th>
                  <th>Value USD</th>
                </tr>
              </thead>
              <tbody>
                <tr repeat.for="item of model.purchaseList">
                  <td>${item.purchaseNumber}</td>
                  <td>${item.purchaseDate | dateFormat: "DD/MM/YYYY"}</td>
                  <td>${item.supplierName}</td>
                  <td>${item.bagsIn | numberFormat: "0,0"} bags (abt ${item.weightKg/1000 | numberFormat: "0,0"} mt)
                  </td>
                  <td>${item.purchaseDetails[0].currency.toUpperCase()} ${item.value | numberFormat: "0,0"}</td>
                  <td>USD ${item.valueUsd | numberFormat: "0,0"}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </div>
  </div>
</template>
